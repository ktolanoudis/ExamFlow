<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ExamFlow</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
body { font-family: Arial; background:#f4f4f4; margin:0; padding-bottom:90px; }
header {background: #4f46e5;color: white;padding: 20px ;text-align: center; font-size: 28px; font-weight: bold;}
main { max-width:900px; margin:40px auto; background:white; padding:20px; border-radius:10px; }
button { padding:10px; background:#4f46e5; color:white; border:none; border-radius:6px; }
textarea { width:100%; }

/* ===== Footer Logos Styling ===== */
.footer-logos {
    position: fixed;
    bottom: 20px;
    left: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.footer-logo {
    height: 40px;
}

.footer-divider {
    width: 2px;
    height: 40px;
    background: #000;
}
</style>
</head>
<body>

<header>ExamFlow</header>

<main>
<h2>Upload PDF</h2>
<input id="pdfInput" type="file" multiple />
<p id="status" style="display:none;"></p> <!-- hidden initially -->

<div id="questionBox" style="display:none;">
  <h3 id="questionText"></h3>
  <textarea id="answer" rows="5"></textarea>
  <br><br>
  <button onclick="checkAnswer()">Check</button>
  <p id="feedback"></p>
</div>
</main>

<!-- ✅ Bottom-left logos -->
<div class="footer-logos">
    <img class="footer-logo"
         src="https://upload.wikimedia.org/wikipedia/commons/9/99/ETH_Z%C3%BCrich_Logo_black.svg"
         alt="ETH Zürich Logo">

    <div class="footer-divider"></div>

    <img class="footer-logo"
         src="https://im.ethz.ch/research/_jcr_content/par/twocolumn/par_left/textimage_1894561152/image.imageformat.text50percent.685615658.svg"
         alt="ETH D-INFK Logo">
</div>

<script>
const statusEl = document.getElementById('status');
const questionBox = document.getElementById('questionBox');
const questionText = document.getElementById('questionText');
const feedbackEl = document.getElementById('feedback');

let modelAnswer = "";

document.getElementById('pdfInput').addEventListener('change', async (ev) => {
    const files = Array.from(ev.target.files);
    if (!files.length) return;
    statusEl.style.display = "block";
    statusEl.textContent = "Uploading PDFs...";
    await uploadAndAsk(files);
});

async function uploadAndAsk(files) {
    statusEl.textContent = "Uploading PDFs...";

    const formData = new FormData();
    for (const f of files) {
        console.log("Sending:", f.name);
        formData.append('files', f);
    }

    try {
        const resp = await axios.post('http://localhost:8000/upload_pdf/', formData);
        console.log("Response:", resp.data);

        const parsed = JSON.parse(resp.data.question);
        questionText.textContent = parsed.question;
        modelAnswer = parsed.model_answer;

        questionBox.style.display = "block";
        statusEl.textContent = "Question ready!";
    } catch (err) {
        statusEl.textContent = "Upload error: " + err.message;
        console.error(err);
    }
}

async function checkAnswer() {
    const studentAnswer = document.getElementById('answer').value;

    const fd = new FormData();
    fd.append('student_answer', studentAnswer);
    fd.append('model_answer', modelAnswer);

    const resp = await axios.post('http://localhost:8000/check_answer/', fd);
    const parsed = JSON.parse(resp.data.result);

    feedbackEl.textContent = parsed.Grade + " - " + parsed.feedback;
}
</script>
</body>
</html>
